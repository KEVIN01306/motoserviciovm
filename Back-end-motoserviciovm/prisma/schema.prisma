// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}




model Sucursal {
  id              Int @id @default(autoincrement())
  nombre          String @unique
  direccion       String
  telefono        String
  email           String

  usuarios        User[] @relation("UserSucursales")
  servicios       Servicio[]
  citas           Cita[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  estadoId        Int
  estado          Estado @relation(fields: [estadoId], references: [id])
}

model User {
  id              Int @id @default(autoincrement())
  primerNombre    String
  segundoNombre   String?
  primerApellido  String
  segundoApellido String?
  fechaNac        DateTime
  dpi             String?
  nit             String?        
  tipo            String?
  activo          Boolean @default(true)
  numeroTel       String  
  numeroAuxTel    String?
  email           String  @unique
  password        String?

  roles           Rol[] @relation("UserRoles")

  sucursales      Sucursal[] @relation("UserSucursales")

  motos           Moto[] @relation("UserMotos")

  serviciosComoCliente Servicio[] @relation("ServicioCliente")
  serviciosComoMecanico Servicio[] @relation("ServicioMecanico")
  ventas           Venta[]
  citas            Cita[] @relation("CitaCliente")

  estadoId        Int
  estado          Estado @relation(fields: [estadoId], references: [id])

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Rol {
  id              Int @id @default(autoincrement())
  rol             String @unique
  descripcion     String?

  usuarios        User[] @relation("UserRoles")
  permisos        Permiso[] @relation("RolPermisos")

  estadoId        Int
  estado          Estado @relation(fields: [estadoId], references: [id])

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}


model Permiso {
  id              Int @id @default(autoincrement())
  permiso         String @unique
  modulo          String?
  roles           Rol[] @relation("RolPermisos")

  estadoId        Int
  estado          Estado @relation(fields: [estadoId], references: [id])

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}



model Marca {
  id              Int @id @default(autoincrement())
  marca           String @unique

  estadoId        Int
  estado          Estado @relation(fields: [estadoId], references: [id])

  modelos         Modelo[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Linea {
  id              Int @id @default(autoincrement())
  linea           String @unique

  estadoId        Int
  estado          Estado @relation(fields: [estadoId], references: [id])

  modelos         Modelo[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Cilindrada {
  id              Int @id @default(autoincrement())
  cilindrada      Int @unique

  estadoId        Int
  estado          Estado @relation(fields: [estadoId], references: [id])

  modelos         Modelo[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Modelo {
  id              Int @id @default(autoincrement())
  a√±o             Int

  modelo          String @unique

  marcaId         Int
  marca           Marca @relation(fields: [marcaId], references: [id])

  lineaId         Int
  linea           Linea @relation(fields: [lineaId], references: [id])

  cilindradaId    Int
  cilindrada      Cilindrada @relation(fields: [cilindradaId], references: [id])    

  estadoId        Int
  estado          Estado @relation(fields: [estadoId], references: [id])

  motos           Moto[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Estado {
  id              Int @id @default(autoincrement())
  estado          String @unique

  motos           Moto[]
  users           User[]
  sucursales      Sucursal[]
  roles           Rol[]
  permisos        Permiso[]
  marcas          Marca[]
  lineas          Linea[]
  cilindradas     Cilindrada[]
  modelos         Modelo[]
  tipoServicios   TipoServicio[]
  opcionServicios OpcionServicio[]
  servicios       Servicio[]
  inventarios     Inventario[]
  categoriaProductos CategoriaProducto[]
  productos       Producto[]
  ventas          Venta[]
  enParqueos      EnParqueo[]
  enReparaciones  EnReparacion[]
  repuestosReparaciones RepuestosReparacion[]
  citas           Cita[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Moto {
  id              Int @id @default(autoincrement())

  placa           String @unique
  avatar          String?
  
  modeloId        Int
  modelo          Modelo @relation(fields: [modeloId], references: [id])

  users           User[] @relation("UserMotos")

  estadoId        Int
  estado          Estado @relation(fields: [estadoId], references: [id])

  servicios       Servicio[]
  enParqueos      EnParqueo[]
  enReparaciones  EnReparacion[]
  citas           Cita[]


  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model TipoServicio {
  id              Int @id @default(autoincrement())
  tipo            String @unique
  descripcion     String?

  opcionServicios OpcionServicio[] @relation("TipoOpcionServicios")

  servicios       Servicio[]

  estadoId        Int
  estado          Estado @relation(fields: [estadoId], references: [id])

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model OpcionServicio {
  id              Int @id @default(autoincrement())
  opcion          String @unique
  descripcion     String?

  tipoServicios TipoServicio[] @relation("TipoOpcionServicios")

  estadoId        Int
  estado          Estado @relation(fields: [estadoId], references: [id])

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Servicio {
  id              Int @id @default(autoincrement())
  descripcion     String

  fechaEntrada    DateTime

  fechaSalida     DateTime

  total           Float

  observaciones    String?

  proximaFechaServicio DateTime?

  descripcionProximoServicio String?

  sucursalId     Int
  sucursal       Sucursal @relation(fields: [sucursalId], references: [id])

  motoId          Int
  moto            Moto @relation(fields: [motoId], references: [id])

  clienteId      Int?
  cliente        User? @relation("ServicioCliente", fields: [clienteId], references: [id])

  mecanicoId     Int
  mecanico       User @relation("ServicioMecanico", fields: [mecanicoId], references: [id])

  tipoServicioId  Int
  tipoServicio    TipoServicio @relation(fields: [tipoServicioId], references: [id])

  estadoId        Int
  estado          Estado @relation(fields: [estadoId], references: [id])

  imagen          Imagen[]  

  servicioItems   ServicioInventario[]
  ventas           Venta[]
  productosCliente ServicioProductoCliente[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Imagen {
  id              Int @id @default(autoincrement())
  imagen          String

  descripcion     String

  servicioId      Int
  servicio        Servicio @relation(fields: [servicioId], references: [id])

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model ServicioProductoCliente {
  id              Int @id @default(autoincrement())

  nombre          String
  cantidad       Int

  servicioId      Int
  servicio        Servicio @relation(fields: [servicioId], references: [id])

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

}

model ServicioInventario {
  id              Int @id @default(autoincrement())
  servicioId      Int
  servicio        Servicio @relation(fields: [servicioId], references: [id])

  inventarioId    Int
  inventario      Inventario @relation(fields: [inventarioId], references: [id])

  checked         Boolean @default(false)

  itemName        String?
  itemDescripcion String?
  notas           String?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([servicioId, inventarioId])
}

model Inventario {
  id              Int @id @default(autoincrement())
  item            String
  descripcion     String?
  activo          Boolean @default(true)

  servicioItems   ServicioInventario[]

  estadoId        Int
  estado          Estado @relation(fields: [estadoId], references: [id])

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model CategoriaProducto {
  id              Int @id @default(autoincrement())
  categoria       String @unique

  productos       Producto[]

  estadoId        Int
  estado          Estado @relation(fields: [estadoId], references: [id])

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}


model Producto {
  id              Int @id @default(autoincrement())
  nombre          String
  descripcion     String?
  costo           Float
  precio          Float
  imagen          String?

  cantidad        Int

  ventasProductos VentaProducto[] @relation("Producto_VentaProducto")

  categoriaId     Int
  categoria       CategoriaProducto @relation(fields: [categoriaId], references: [id])

  estadoId        Int
  estado          Estado @relation(fields: [estadoId], references: [id])

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}


model Venta {
  id              Int @id @default(autoincrement())

  usuarioId       Int
  usuario         User @relation(fields: [usuarioId], references: [id])

  servicioId      Int?
  servicio        Servicio? @relation(fields: [servicioId], references: [id])
  
  total           Float

  productos       VentaProducto[] @relation("Venta_VentaProducto")

  estadoId        Int
  estado          Estado @relation(fields: [estadoId], references: [id])

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model VentaProducto {
  id              Int @id @default(autoincrement())

  ventaId         Int
  venta           Venta @relation("Venta_VentaProducto", fields: [ventaId], references: [id])

  productoId      Int
  producto       Producto @relation("Producto_VentaProducto", fields: [productoId], references: [id])

  cantidad       Int

  totalProducto  Float

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([ventaId, productoId])
}


model EnParqueo {
  id              Int @id @default(autoincrement())
  descripcion     String

  fechaEntrada    DateTime

  fechaSalida     DateTime?

  total           Float?

  observaciones    String?

  motoId          Int
  moto            Moto @relation(fields: [motoId], references: [id])  

  estadoId        Int
  estado          Estado @relation(fields: [estadoId], references: [id])

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model EnReparacion {
  id              Int @id @default(autoincrement())
  descripcion     String

  fechaEntrada    DateTime

  fechaSalida     DateTime?

  total           Float?

  observaciones    String?

  motoId          Int
  moto            Moto @relation(fields: [motoId], references: [id])  

  repuestos       RepuestosReparacion[]

  estadoId        Int
  estado          Estado @relation(fields: [estadoId], references: [id])

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model RepuestosReparacion {
  id              Int @id @default(autoincrement())
  nombre          String
  descripcion     String

  imagen          String?

  refencia       String
  cantidad       Int

  checked         Boolean @default(false)

  reparacionId    Int
  reparacion      EnReparacion @relation(fields: [reparacionId], references: [id])

  estadoId        Int
  estado          Estado @relation(fields: [estadoId], references: [id])

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Cita {
  id              Int @id @default(autoincrement())
  descripcion     String

  fechaCita       DateTime

  nombreContacto String
  telefonoContacto String

  sucursalId     Int
  sucursal       Sucursal @relation(fields: [sucursalId], references: [id])

  clienteId      Int?
  cliente        User? @relation("CitaCliente", fields: [clienteId], references: [id])

  dpiNit          String?

  motoId          Int
  moto            Moto @relation(fields: [motoId], references: [id])  

  placa          String?


  estadoId        Int
  estado          Estado @relation(fields: [estadoId], references: [id])

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}